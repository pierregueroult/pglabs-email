services:
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
    restart: always

  backend:
    build:
      context: .
      dockerfile: apps/backend/Dockerfile
    ports:
      - "${BACKEND_PORT:-3001}:${BACKEND_PORT:-3001}"
    environment:
      - PORT=${BACKEND_PORT}
      - NODE_ENV=${BACKEND_NODE_ENV}
      - CORS_ORIGINS=${BACKEND_CORS_ORIGINS}
      - REDIS_URL=${BACKEND_REDIS_URL}
      - JWT_SECRET=${BACKEND_JWT_SECRET}
      - JWT_EXPIRES_IN=${BACKEND_JWT_EXPIRES_IN}
      - OIDC_CALLBACK_URL=${BACKEND_OIDC_CALLBACK_URL}
      - OIDC_ISSUER=${BACKEND_OIDC_ISSUER}
      - OIDC_CLIENT_ID=${BACKEND_OIDC_CLIENT_ID}
      - OIDC_CLIENT_SECRET=${BACKEND_OIDC_CLIENT_SECRET}
      - OAUTH_AUTHORIZATION_URL=${BACKEND_OAUTH_AUTHORIZATION_URL}
      - OAUTH_TOKEN_URL=${BACKEND_OAUTH_TOKEN_URL}
      - OAUTH_USER_INFO_URL=${BACKEND_OAUTH_USER_INFO_URL}
      - KEYCLOAK_ADMIN_URL=${BACKEND_KEYCLOAK_ADMIN_URL}
      - KEYCLOAK_ADMIN_REALM=${BACKEND_KEYCLOAK_ADMIN_REALM}
      - KEYCLOAK_ADMIN_CLIENT_ID=${BACKEND_KEYCLOAK_ADMIN_CLIENT_ID}
      - KEYCLOAK_ADMIN_CLIENT_SECRET=${BACKEND_KEYCLOAK_ADMIN_CLIENT_SECRET}
      - STALWART_API_URL=${BACKEND_STALWART_API_URL}
      - STALWART_ADMIN_USERNAME=${BACKEND_STALWART_ADMIN_USERNAME}
      - STALWART_ADMIN_PASSWORD=${BACKEND_STALWART_ADMIN_PASSWORD}
      - STALWART_SMTP_HOST=${BACKEND_STALWART_SMTP_HOST}
      - STALWART_SMTP_PORT=${BACKEND_STALWART_SMTP_PORT}
      - ENCRYPTION_KEY=${BACKEND_ENCRYPTION_KEY}
    depends_on:
      - redis

  frontend:
    build:
      context: .
      dockerfile: apps/frontend/Dockerfile
    ports:
      - "3000:3000"
    depends_on:
      - backend
